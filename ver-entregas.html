<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Entregas de Estudiantes | Charlotte</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <style>
        body { background: #f8fafc; margin: 0; }
        .main-content { max-width: 900px; margin: 40px auto; background: #fff; border-radius: 16px; box-shadow: 0 2px 12px #0001; padding: 32px; }
        .entrega-card { background: #f1f5f9; border-radius: 10px; margin-bottom: 24px; padding: 20px; display: flex; align-items: flex-start; gap: 24px; }
        .entrega-info { flex: 1; }
        .entrega-archivo { min-width: 120px; }
        .entrega-archivo a { display: inline-block; background: #3b82f6; color: #fff; padding: 8px 16px; border-radius: 6px; text-decoration: none; font-weight: 600; }
        .entrega-archivo a:hover { background: #1e40af; }
        .entrega-calificar { margin-top: 12px; }
        .btn-calificar { background: #10b981; color: #fff; border: none; padding: 8px 18px; border-radius: 6px; font-weight: 600; cursor: pointer; }
        .btn-calificar:hover { background: #059669; }
        .nota-label { font-weight: bold; color: #0a1628; }
        .observacion-label { color: #64748b; font-size: 14px; }
    </style>
</head>
<body>
    <div class="main-content">
        <h1><i class="fas fa-inbox"></i> Entregas de Estudiantes</h1>
        <div id="entregas-list">
            <div style="text-align:center; color:#64748b; margin-top:40px;">
                <i class="fas fa-spinner fa-spin" style="font-size:32px;"></i>
                <p>Cargando entregas...</p>
            </div>
        </div>
    </div>
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore-compat.js"></script>
    <script>
const firebaseConfig = {
    apiKey: "AIzaSyCBpoxr8yhAfCVqP00b6DKtMA0JWljlMMA",
    authDomain: "charlotte-babda.firebaseapp.com",
    projectId: "charlotte-babda",
    storageBucket: "charlotte-babda.firebasestorage.app",
    messagingSenderId: "486360806502",
    appId: "1:486360806502:web:d82fb7f351b8fe4587a9a7"
};
const app = firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

async function loadEntregas() {
    const cont = document.getElementById('entregas-list');
    cont.innerHTML = '<div style="text-align:center; color:#64748b; margin-top:40px;"><i class="fas fa-spinner fa-spin" style="font-size:32px;"></i><p>Cargando entregas...</p></div>';
    try {
        const snap = await db.collection('entregas').orderBy('fecha', 'desc').get();
        if (snap.empty) {
            cont.innerHTML = '<div style="text-align:center; color:#64748b; margin-top:40px;">No hay entregas registradas.</div>';
            return;
        }
        cont.innerHTML = Array.from(snap.docs).map(doc => {
            const d = doc.data();
            return `<div class='entrega-card'>
                <div class='entrega-info'>
                    <h3><i class='fas fa-user'></i> ${d.estudianteNombre || 'Sin nombre'}</h3>
                    <p><b>Actividad:</b> ${d.actividadTitulo || 'Sin título'}<br>
                    <b>Fecha:</b> ${d.fecha || ''}</p>
                    <div class='entrega-calificar'>
                        <label class='nota-label'>Calificación:</label>
                        <input type='number' min='0' max='100' step='0.1' id='nota_${doc.id}' value='${d.calificacion || ''}' style='width:80px; margin-right:10px;'>
                        <label class='observacion-label'>Observación:</label>
                        <input type='text' id='obs_${doc.id}' value='${d.observacion || ''}' style='width:220px; margin-right:10px;'>
                        <button class='btn-calificar' onclick='guardarCalificacionEntrega("${doc.id}")'>Guardar</button>
                    </div>
                </div>
                <div class='entrega-archivo'>
                    ${d.archivoURL ? `<a href='${d.archivoURL}' target='_blank'><i class='fas fa-file'></i> Ver Archivo</a>` : '<span style="color:#64748b;">Sin archivo</span>'}
                </div>
            </div>`;
        }).join('');
    } catch (e) {
        cont.innerHTML = '<div style="color:red;">Error al cargar entregas</div>';
    }
}

async function guardarCalificacionEntrega(id) {
    const nota = document.getElementById('nota_' + id).value;
    const obs = document.getElementById('obs_' + id).value;
    try {
        await db.collection('entregas').doc(id).update({ calificacion: nota, observacion: obs });
        alert('Calificación guardada');
    } catch (e) {
        alert('Error al guardar calificación');
    }
}

window.onload = loadEntregas;
    </script>
</body>
</html>
