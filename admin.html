<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Panel Administrador | Charlotte</title>
    <!-- Actualizado: 11/12/2025 16:38:02 -->
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <style>
        body { background: #f8fafc; margin: 0; }
        .admin-header { background: linear-gradient(135deg, #1e3a8a, #3b82f6); color: #fff; padding: 20px 0; position: sticky; top: 0; z-index: 100; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        .admin-header .container { display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 15px; }
        .admin-header h1 { margin: 0; font-size: 24px; }
        .admin-header h1 i { margin-right: 10px; }
        .logout-btn { background: rgba(255,255,255,0.2); color: #fff; border: none; padding: 10px 20px; border-radius: 8px; cursor: pointer; font-weight: 600; transition: all 0.3s; }
        .logout-btn:hover { background: rgba(255,255,255,0.3); }
        .dashboard-container { display: grid; grid-template-columns: 280px 1fr; min-height: calc(100vh - 80px); gap: 0; }
        .sidebar { background: #fff; border-right: 1px solid #e8f0fe; padding: 0; }
        .sidebar-header { padding: 24px; border-bottom: 2px solid #e8f0fe; background: linear-gradient(135deg, #f0f9ff, #e0f2fe); text-align: center; }
        .sidebar-header img { height: 60px; width: auto; margin-bottom: 12px; }
        .sidebar-header h3 { margin: 0 0 8px 0; color: #1e3a8a; font-size: 18px; }
        .sidebar-header p { margin: 0; color: #64748b; font-size: 14px; }
        .nav-menu { padding: 0; }
        .nav-item { padding: 16px 24px; display: flex; align-items: center; gap: 12px; cursor: pointer; transition: all 0.3s; border-left: 3px solid transparent; color: #334155; }
        .nav-item:hover { background: #f8fafc; border-left-color: #3b82f6; }
        .nav-item.active { background: linear-gradient(90deg, rgba(59,130,246,0.1), transparent); border-left-color: #3b82f6; color: #1e40af; font-weight: 600; }
        .nav-item i { font-size: 18px; width: 24px; text-align: center; }
        .main-content { padding: 32px; overflow-y: auto; }
        .content-section { display: none; }
        .content-section.active { display: block; }
        .page-header { margin-bottom: 32px; }
        .page-header h2 { margin: 0 0 8px 0; color: #0a1628; font-size: 32px; }
        .page-header p { margin: 0; color: #64748b; font-size: 16px; }
        .upload-card { background: #fff; border-radius: 12px; padding: 32px; box-shadow: 0 2px 8px rgba(0,0,0,0.08); margin-bottom: 24px; }
        .upload-card h3 { margin: 0 0 24px 0; color: #1e3a8a; font-size: 20px; display: flex; align-items: center; gap: 10px; }
        .form-group { margin-bottom: 20px; }
        .form-group label { display: block; margin-bottom: 8px; color: #334155; font-weight: 600; font-size: 14px; }
        .form-group input, .form-group textarea, .form-group select { width: 100%; padding: 12px 16px; border: 2px solid #e2e8f0; border-radius: 8px; font-size: 14px; transition: all 0.3s; font-family: inherit; box-sizing: border-box; }
        .form-group input:focus, .form-group textarea:focus, .form-group select:focus { outline: none; border-color: #3b82f6; box-shadow: 0 0 0 3px rgba(59,130,246,0.1); }
        .form-group textarea { resize: vertical; min-height: 120px; }
        .btn { padding: 12px 24px; border: none; border-radius: 8px; font-weight: 600; cursor: pointer; transition: all 0.3s; font-size: 14px; display: inline-flex; align-items: center; gap: 8px; }
        .btn-primary { background: linear-gradient(135deg, #3b82f6, #1d4ed8); color: #fff; }
        .btn-primary:hover { transform: translateY(-2px); box-shadow: 0 4px 12px rgba(59,130,246,0.4); }
        .content-list { background: #fff; border-radius: 12px; overflow: hidden; box-shadow: 0 2px 8px rgba(0,0,0,0.08); }
        .content-list-header { padding: 20px 24px; background: linear-gradient(135deg, #f0f9ff, #e0f2fe); border-bottom: 2px solid #e2e8f0; }
        .content-list-header h4 { margin: 0; color: #1e3a8a; font-size: 18px; }
        .content-item { padding: 20px 24px; border-bottom: 1px solid #f1f5f9; display: flex; justify-content: space-between; align-items: center; transition: all 0.3s; }
        .content-item:hover { background: #f8fafc; }
        .content-item:last-child { border-bottom: none; }
        .content-info { flex: 1; }
        .content-info h5 { margin: 0 0 4px 0; color: #0a1628; font-size: 16px; }
        .content-info p { margin: 0; color: #64748b; font-size: 14px; }
        .content-actions { display: flex; gap: 8px; }
        .btn-icon { width: 36px; height: 36px; border-radius: 8px; border: none; cursor: pointer; display: flex; align-items: center; justify-content: center; transition: all 0.3s; }
        .btn-delete { background: #fee2e2; color: #dc2626; }
        .btn-delete:hover { background: #fecaca; }
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 24px; margin-bottom: 32px; }
        .stat-card { background: #fff; padding: 24px; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.08); }
        .stat-card:hover { transform: translateY(-2px); box-shadow: 0 4px 16px rgba(0,0,0,0.12); transition: all 0.3s; }
        .stat-card-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 16px; }
        .stat-card-icon { width: 48px; height: 48px; border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 24px; }
        .stat-card-icon.blue { background: #dbeafe; color: #3b82f6; }
        .stat-card-icon.green { background: #dcfce7; color: #22c55e; }
        .stat-card-icon.purple { background: #f3e8ff; color: #a855f7; }
        .stat-card-icon.orange { background: #fed7aa; color: #f97316; }
        .stat-value { font-size: 32px; font-weight: 700; color: #0a1628; margin: 0; }
        .stat-label { color: #64748b; font-size: 14px; margin: 4px 0 0 0; }
        .mobile-menu-toggle { display: none; background: rgba(255,255,255,0.2); border: none; color: #fff; font-size: 24px; padding: 8px 12px; border-radius: 8px; cursor: pointer; }
        .alert { padding: 16px 20px; border-radius: 8px; margin-bottom: 20px; display: flex; align-items: center; gap: 12px; }
        .alert-success { background: #dcfce7; color: #166534; border-left: 4px solid #22c55e; }
        .alert-info { background: #dbeafe; color: #1e40af; border-left: 4px solid #3b82f6; }
        .alert i { font-size: 20px; }
        @media (max-width: 768px) {
            .dashboard-container { grid-template-columns: 1fr; }
            .sidebar { position: fixed; left: -100%; top: 60px; width: 280px; height: calc(100vh - 60px); z-index: 99; transition: left 0.3s ease; box-shadow: 2px 0 8px rgba(0,0,0,0.1); }
            .sidebar.open { left: 0; }
            .mobile-menu-toggle { display: block; }
            .main-content { padding: 20px 16px; }
            .page-header h2 { font-size: 24px; }
            .upload-card { padding: 20px; }
            .stats-grid { grid-template-columns: 1fr; }
            .content-item { flex-direction: column; align-items: flex-start; gap: 12px; }
            .content-actions { width: 100%; justify-content: flex-end; }
        }
    </style>
</head><body>
    <header class="admin-header">
        <div class="container">
            <h1><i class="fas fa-user-shield"></i> Panel Administrador</h1>
            <button class="mobile-menu-toggle" onclick="toggleMobileMenu()"><i class="fas fa-bars"></i></button>
            <button class="logout-btn" onclick="logout()"><i class="fas fa-sign-out-alt"></i> Cerrar Sesi√≥n</button>
        </div>
    </header>
    <div class="dashboard-container">
        <div class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <img src="fotos/logo.png" alt="Charlotte Logo" onerror="this.style.display='none'">
                <h3>Admin Charlotte</h3>
                <p>Gesti√≥n de Contenidos</p>
            </div>
            <div class="nav-menu">
                <div class="nav-item active" onclick="showSection('dashboard', event)"><i class="fas fa-chart-line"></i><span>Dashboard</span></div>
                <div class="nav-item" onclick="showSection('usuarios', event)"><i class="fas fa-user-check"></i><span>Aprobar Usuarios</span></div>
                <div class="nav-item" onclick="showSection('calificaciones', event)"><i class="fas fa-star"></i><span>Calificaciones</span></div>
                <div class="nav-item" onclick="showSection('videos', event)"><i class="fas fa-video"></i><span>Subir Videos</span></div>
                <div class="nav-item" onclick="showSection('clases', event)"><i class="fas fa-book-open"></i><span>Subir Clases</span></div>
                <div class="nav-item" onclick="showSection('actividades', event)"><i class="fas fa-tasks"></i><span>Subir Actividades</span></div>
                <div class="nav-item" onclick="window.location.href='ver-entregas.html'"><i class="fas fa-inbox"></i><span>Ver Entregas</span></div>
                <div class="nav-item" onclick="showSection('cuestionarios', event)"><i class="fas fa-file-alt"></i><span>Subir Cuestionarios</span></div>
                <div class="nav-item" onclick="showSection('evaluaciones', event)"><i class="fas fa-clipboard-check"></i><span>Evaluaciones</span></div>
                <div class="nav-item" onclick="showSection('materiales', event)"><i class="fas fa-folder-open"></i><span>Subir Materiales</span></div>
            </div>
        </div>
        <div class="main-content">
            <div id="dashboard" class="content-section active">
                <div class="page-header"><h2>Dashboard</h2><p>Resumen de contenidos publicados</p></div>
                <div class="stats-grid">
                    <div class="stat-card" onclick="showSection('videos', event)" style="cursor: pointer;">
                        <div class="stat-card-header">
                            <div>
                                <h3 class="stat-value" id="stat-videos">0</h3>
                                <p class="stat-label">Videos Publicados</p>
                            </div>
                            <div class="stat-card-icon blue"><i class="fas fa-video"></i></div>
                        </div>
                    </div>
                    <div class="stat-card" onclick="showSection('clases', event)" style="cursor: pointer;">
                        <div class="stat-card-header">
                            <div>
                                <h3 class="stat-value" id="stat-clases">0</h3>
                                <p class="stat-label">Clases Subidas</p>
                            </div>
                            <div class="stat-card-icon green"><i class="fas fa-book-open"></i></div>
                        </div>
                    </div>
                    <div class="stat-card" onclick="showSection('actividades', event)" style="cursor: pointer;">
                        <div class="stat-card-header">
                            <div>
                                <h3 class="stat-value" id="stat-actividades">0</h3>
                                <p class="stat-label">Actividades Creadas</p>
                            </div>
                            <div class="stat-card-icon purple"><i class="fas fa-tasks"></i></div>
                        </div>
                    </div>
                    <div class="stat-card" onclick="showSection('materiales', event)" style="cursor: pointer;">
                        <div class="stat-card-header">
                            <div>
                                <h3 class="stat-value" id="stat-materiales">0</h3>
                                <p class="stat-label">Materiales Adicionales</p>
                            </div>
                            <div class="stat-card-icon orange"><i class="fas fa-folder-open"></i></div>
                        </div>
                    </div>
                </div>
            </div>
            <div id="usuarios" class="content-section">
                <div class="page-header"><h2>Gesti√≥n de Usuarios</h2><p>Aprueba o rechaza solicitudes de registro</p></div>
                
                <div style="background: #fef3c7; border-left: 4px solid #f59e0b; padding: 16px; border-radius: 8px; margin-bottom: 20px;">
                    <strong><i class="fas fa-exclamation-triangle"></i> Importante sobre contrase√±as:</strong>
                    <p style="margin: 8px 0 0 0; color: #92400e;">
                        ‚Ä¢ Nuevas aprobaciones: Los estudiantes mantienen la contrase√±a que ingresaron al registrarse<br>
                        ‚Ä¢ Si un estudiante no puede ingresar: Usa el bot√≥n "Restablecer" en Usuarios Aprobados para cambiar su contrase√±a<br>
                        ‚Ä¢ Puedes ver y copiar las contrase√±as de todos los usuarios aprobados
                    </p>
                </div>
                
                <div class="content-list">
                    <div class="content-list-header"><h4>Solicitudes Pendientes</h4></div>
                    <div id="usuarios-pendientes"></div>
                </div>
                <div class="content-list" style="margin-top: 24px;">
                    <div class="content-list-header" style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 15px;">
                        <h4>Usuarios Aprobados</h4>
                        <div style="display: flex; gap: 10px;">
                            <select id="filterPrograma" onchange="loadUsuariosAprobados()" style="padding: 8px 12px; border: 2px solid #e2e8f0; border-radius: 8px;">
                                <option value="">Todos los programas</option>
                                <option value="Panader√≠a">Panader√≠a</option>
                                <option value="Belleza">Belleza</option>
                            </select>
                            <select id="filterLugar" onchange="loadUsuariosAprobados()" style="padding: 8px 12px; border: 2px solid #e2e8f0; border-radius: 8px;">
                                <option value="">Todos los lugares</option>
                            </select>
                        </div>
                    </div>
                    <div id="usuarios-aprobados"></div>
                </div>
            </div>
            <div id="calificaciones" class="content-section">
                <div class="page-header"><h2>Gesti√≥n de Calificaciones</h2><p>Administra las calificaciones de los estudiantes</p></div>
                
                <div class="filters" style="background: white; padding: 20px; border-radius: 12px; margin-bottom: 30px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                    <div style="display: flex; gap: 15px; flex-wrap: wrap; align-items: end;">
                        <div style="flex: 1; min-width: 200px;">
                            <label style="display: block; margin-bottom: 8px; font-weight: 600;">
                                <i class="fas fa-user"></i> Estudiante
                            </label>
                            <select id="calificaciones-estudiante" onchange="loadCalificaciones()" style="width: 100%; padding: 10px; border: 2px solid #e2e8f0; border-radius: 8px;">
                                <option value="">Selecciona un estudiante</option>
                            </select>
                        </div>
                        <div style="flex: 1; min-width: 200px;">
                            <label style="display: block; margin-bottom: 8px; font-weight: 600;">
                                <i class="fas fa-book"></i> Programa
                            </label>
                            <select id="calificaciones-programa" onchange="cargarEstudiantesPorPrograma()" style="width: 100%; padding: 10px; border: 2px solid #e2e8f0; border-radius: 8px;">
                                <option value="">Todos los programas</option>
                                <option value="Panader√≠a">Panader√≠a</option>
                                <option value="Belleza">Belleza</option>
                            </select>
                        </div>
                        <button onclick="resetCalificaciones()" class="btn" style="background: #64748b; color: white;">
                            <i class="fas fa-sync"></i> Limpiar
                        </button>
                    </div>
                </div>

                <div id="calificaciones-content"></div>
            </div>
            <div id="videos" class="content-section">
                <div class="page-header"><h2>Gesti√≥n de Videos</h2><p>Sube y administra videos para tus estudiantes</p></div>
                <div class="upload-card">
                    <h3><i class="fas fa-cloud-upload-alt"></i> Subir Nuevo Video</h3>
                    <form id="form-video" onsubmit="saveVideo(event)">
                        <div class="form-group"><label>T√≠tulo del Video *</label><input type="text" name="titulo" required placeholder="Ej: Introducci√≥n a la Panader√≠a"></div>
                        <div class="form-group"><label>Descripci√≥n</label><textarea name="descripcion" placeholder="Describe el contenido del video..."></textarea></div>
                        <div class="form-group"><label>URL del Video (YouTube, Vimeo, etc.) *</label><input type="url" name="url" required placeholder="https://youtube.com/watch?v=..."></div>
                        <div class="form-group"><label>Programa *</label><select name="programa" required><option value="">Selecciona un programa</option><option value="Panader√≠a">Panader√≠a y Reposter√≠a</option><option value="Belleza">Belleza y Cosmetolog√≠a</option><option value="Todos">Todos los programas</option></select></div>
                        <button type="submit" class="btn btn-primary"><i class="fas fa-save"></i> Guardar Video</button>
                    </form>
                </div>
                <div class="content-list"><div class="content-list-header"><h4>Videos Publicados</h4></div><div id="videos-list"></div></div>
            </div>
            <div id="clases" class="content-section">
                <div class="page-header"><h2>Gesti√≥n de Clases</h2><p>Crea y publica material de clases</p></div>
                <div class="upload-card">
                    <h3><i class="fas fa-cloud-upload-alt"></i> Subir Nueva Clase</h3>
                    <form id="form-clase" onsubmit="saveClase(event)">
                        <div class="form-group"><label>T√≠tulo de la Clase *</label><input type="text" name="titulo" required placeholder="Ej: T√©cnicas de Amasado"></div>
                        <div class="form-group"><label>Contenido *</label><textarea name="contenido" required placeholder="Escribe el contenido de la clase..."></textarea></div>
                        <div class="form-group"><label>Programa *</label><select name="programa" required><option value="">Selecciona un programa</option><option value="Panader√≠a">Panader√≠a y Reposter√≠a</option><option value="Belleza">Belleza y Cosmetolog√≠a</option><option value="Todos">Todos los programas</option></select></div>
                        <button type="submit" class="btn btn-primary"><i class="fas fa-save"></i> Guardar Clase</button>
                    </form>
                </div>
                <div class="content-list"><div class="content-list-header"><h4>Clases Publicadas</h4></div><div id="clases-list"></div></div>
            </div>
            <div id="actividades" class="content-section">
                <div class="page-header"><h2>Gesti√≥n de Actividades</h2><p>Crea actividades y tareas para los estudiantes</p></div>
                <div class="upload-card">
                    <h3><i class="fas fa-cloud-upload-alt"></i> Crear Nueva Actividad</h3>
                    <form id="form-actividad" onsubmit="saveActividad(event)">
                        <div class="form-group"><label>T√≠tulo de la Actividad *</label><input type="text" name="titulo" required placeholder="Ej: Pr√°ctica de Pan Franc√©s"></div>
                        <div class="form-group"><label>Instrucciones *</label><textarea name="instrucciones" required placeholder="Describe las instrucciones de la actividad..."></textarea></div>
                        <div class="form-group"><label>Fecha de Entrega</label><input type="date" name="fecha"></div>
                        <div class="form-group"><label>Programa *</label><select name="programa" required><option value="">Selecciona un programa</option><option value="Panader√≠a">Panader√≠a y Reposter√≠a</option><option value="Belleza">Belleza y Cosmetolog√≠a</option><option value="Todos">Todos los programas</option></select></div>
                        <button type="submit" class="btn btn-primary"><i class="fas fa-save"></i> Crear Actividad</button>
                    </form>
                </div>
                <div class="content-list"><div class="content-list-header"><h4>Actividades Creadas</h4></div><div id="actividades-list"></div></div>
            </div>
            <div id="cuestionarios" class="content-section">
                <div class="page-header"><h2>Gesti√≥n de Cuestionarios</h2><p>Crea cuestionarios con preguntas de opci√≥n m√∫ltiple o abiertas</p></div>
                
                <div class="upload-card">
                    <h3><i class="fas fa-file-alt"></i> Nuevo Cuestionario</h3>
                    <form onsubmit="saveCuestionario(event)" class="upload-form" id="formCuestionario">
                        <input type="text" name="titulo" placeholder="T√≠tulo del cuestionario" required>
                        <textarea name="descripcion" placeholder="Descripci√≥n o instrucciones" rows="3"></textarea>
                        
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                            <div>
                                <label style="display: block; margin-bottom: 5px; font-weight: 600; color: #0a1628;">Programa</label>
                                <select name="programa" required>
                                    <option value="">Seleccionar programa</option>
                                    <option value="Todos">Todos los programas</option>
                                    <option value="Panader√≠a">Panader√≠a</option>
                                    <option value="Belleza">Belleza</option>
                                </select>
                            </div>
                            <div>
                                <label style="display: block; margin-bottom: 5px; font-weight: 600; color: #0a1628;">Fecha l√≠mite</label>
                                <input type="datetime-local" name="fechaLimite" required>
                            </div>
                        </div>
                        
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                            <div>
                                <label style="display: block; margin-bottom: 5px; font-weight: 600; color: #0a1628;">Tiempo disponible (minutos)</label>
                                <input type="number" name="tiempoDisponible" placeholder="Ej: 30" min="1" required>
                            </div>
                            <div>
                                <label style="display: block; margin-bottom: 5px; font-weight: 600; color: #0a1628;">Intentos permitidos</label>
                                <input type="number" name="intentos" placeholder="Ej: 1" min="1" value="1" required>
                            </div>
                        </div>
                        
                        <hr style="margin: 20px 0; border: none; border-top: 1px solid #e8f0fe;">
                        
                        <h4 style="margin-bottom: 15px; color: #1e3a8a;"><i class="fas fa-question-circle"></i> Preguntas</h4>
                        <div id="preguntasContainer"></div>
                        
                        <button type="button" onclick="agregarPregunta()" class="btn" style="background: #10b981; margin-bottom: 15px;">
                            <i class="fas fa-plus"></i> Agregar Pregunta
                        </button>
                        
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-save"></i> Guardar Cuestionario
                        </button>
                    </form>
                </div>
                
                <div class="content-list">
                    <div class="content-list-header">
                        <h4>Cuestionarios Publicados</h4>
                    </div>
                    <div id="cuestionarios-list"></div>
                </div>
            </div>

            <div id="evaluaciones" class="content-section">
                <div class="page-header"><h2>Gesti√≥n de Evaluaciones</h2><p>Crea evaluaciones con preguntas aleatorias de cuestionarios</p></div>
                
                <div class="alert alert-info">
                    <i class="fas fa-info-circle"></i>
                    <div>
                        <strong>¬øQu√© son las Evaluaciones?</strong>
                        <p style="margin: 4px 0 0 0; font-size: 14px;">Las evaluaciones toman preguntas aleatorias de un cuestionario base. Cada estudiante o intento recibe preguntas diferentes.</p>
                    </div>
                </div>
                
                <div class="upload-card">
                    <h3><i class="fas fa-random"></i> Crear Nueva Evaluaci√≥n</h3>
                    <p style="color: #64748b; margin-bottom: 20px;">Selecciona un cuestionario base y configura cu√°ntas preguntas aleatorias se tomar√°n por intento.</p>
                    <a href="crear-evaluacion.html" class="btn btn-primary" style="text-decoration: none;">
                        <i class="fas fa-plus-circle"></i> Crear Nueva Evaluaci√≥n
                    </a>
                </div>
                
                <div class="content-list">
                    <div class="content-list-header">
                        <h4>Evaluaciones Publicadas</h4>
                    </div>
                    <div id="evaluaciones-list"></div>
                </div>
            </div>

            <div id="materiales" class="content-section">
                <div class="page-header"><h2>Gesti√≥n de Materiales</h2><p>Sube materiales adicionales de estudio</p></div>
                
                <!-- Subir PDFs Embebidos -->
                <div class="upload-card" style="margin-bottom: 30px;">
                    <h3><i class="fas fa-file-pdf"></i> Subir Documentos PDF</h3>
                    <p style="color: #64748b; margin-bottom: 20px;">Los PDFs se mostrar√°n integrados en la p√°gina web para una mejor experiencia</p>
                    <form id="form-pdf" onsubmit="savePDF(event)">
                        <div class="form-group">
                            <label>T√≠tulo del Documento *</label>
                            <input type="text" id="pdf-titulo" required placeholder="Ej: Manual de Panader√≠a B√°sica">
                        </div>
                        <div class="form-group">
                            <label>Descripci√≥n *</label>
                            <textarea id="pdf-descripcion" required placeholder="Describe el contenido del documento..." rows="3"></textarea>
                        </div>
                        <div class="form-group">
                            <label>Programa *</label>
                            <select id="pdf-programa" required>
                                <option value="">Selecciona un programa</option>
                                <option value="Panader√≠a">Panader√≠a y Reposter√≠a</option>
                                <option value="Belleza">Belleza y Cosmetolog√≠a</option>
                                <option value="Todos">Todos los programas</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Seleccionar archivo PDF *</label>
                            <input type="file" id="pdf-file" accept=".pdf" required 
                                   style="padding: 10px; border: 2px dashed #cbd5e1; border-radius: 8px; background: #f8fafc;">
                            <small style="color: #64748b; display: block; margin-top: 8px;">
                                <i class="fas fa-info-circle"></i> Tama√±o m√°ximo recomendado: 10MB
                            </small>
                        </div>
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-upload"></i> Subir PDF
                        </button>
                    </form>
                </div>

                <!-- Subir Enlaces/URLs -->
                <div class="upload-card">
                    <h3><i class="fas fa-link"></i> Agregar Enlaces y Recursos</h3>
                    <form id="form-material" onsubmit="saveMaterial(event)">
                        <div class="form-group"><label>Nombre del Material *</label><input type="text" name="titulo" required placeholder="Ej: Tabla de Equivalencias"></div>
                        <div class="form-group"><label>Descripci√≥n</label><textarea name="descripcion" placeholder="Describe el material..."></textarea></div>
                        <div class="form-group"><label>URL o Enlace *</label><input type="text" name="url" placeholder="URL del archivo o enlace" required></div>
                        <div class="form-group"><label>Programa *</label><select name="programa" required><option value="">Selecciona un programa</option><option value="Panader√≠a">Panader√≠a y Reposter√≠a</option><option value="Belleza">Belleza y Cosmetolog√≠a</option><option value="Todos">Todos los programas</option></select></div>
                        <button type="submit" class="btn btn-primary"><i class="fas fa-save"></i> Guardar Material</button>
                    </form>
                </div>
                
                <!-- Recetarios Est√°ticos -->
                <div class="upload-card" style="background: linear-gradient(135deg, #f0f9ff, #e0f2fe); border: 2px solid #3b82f6;">
                    <h3><i class="fas fa-book"></i> Recetarios Disponibles</h3>
                    <p style="color: #64748b; margin-bottom: 20px;">Acceso r√°pido a los recetarios oficiales del curso</p>
                    <div class="content-item" style="background: white; border-radius: 8px; padding: 16px; margin-bottom: 12px;">
                        <div class="content-info">
                            <h5>üìñ Recetario de Panader√≠a 2024-2025</h5>
                            <p>M√°s de 40 recetas profesionales - Panes, Bizcochos, Pasteler√≠a y m√°s</p>
                        </div>
                        <a href="recetario-index.html" target="_blank" class="btn btn-primary" style="text-decoration:none;">
                            <i class="fas fa-external-link-alt"></i> Ver Recetario
                        </a>
                    </div>
                </div>

                <div class="content-list"><div class="content-list-header"><h4>Materiales Publicados</h4></div><div id="materiales-list"></div></div>
            </div>
        </div>
    </div>
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore-compat.js"></script>
    <script>
const firebaseConfig = {
    apiKey: "AIzaSyCBpoxr8yhAfCVqP00b6DKtMA0JWljlMMA",
    authDomain: "charlotte-babda.firebaseapp.com",
    projectId: "charlotte-babda",
    storageBucket: "charlotte-babda.firebasestorage.app",
    messagingSenderId: "486360806502",
    appId: "1:486360806502:web:d82fb7f351b8fe4587a9a7"
};

const app = firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

const currentUser = JSON.parse(sessionStorage.getItem('currentUser') || 'null');
if (!currentUser || currentUser.role !== 'admin') {
    window.location.href = 'login.html';
}

// Limpiar historial para evitar volver a login con bot√≥n atr√°s
if (window.history && window.history.pushState) {
    window.history.replaceState({page: 'admin'}, 'Panel Administrador', 'admin.html');
}

// Interceptar el bot√≥n atr√°s del navegador
window.addEventListener('popstate', function(event) {
    const activeSection = sessionStorage.getItem('adminActiveSection');
    if (activeSection && activeSection !== 'dashboard') {
        event.preventDefault();
        showSection('dashboard');
        window.history.pushState({page: 'admin', section: 'dashboard'}, 'Dashboard', 'admin.html');
    }
});

// Restaurar la secci√≥n activa al recargar la p√°gina
const savedAdminSection = sessionStorage.getItem('adminActiveSection');
if (savedAdminSection && savedAdminSection !== 'dashboard') {
    window.addEventListener('DOMContentLoaded', () => {
        showSection(savedAdminSection);
    });
} else if (!savedAdminSection) {
    sessionStorage.setItem('adminActiveSection', 'dashboard');
}

window.showSection = function(sectionId, event) {
    document.querySelectorAll('.content-section').forEach(s => s.classList.remove('active'));
    document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
    document.getElementById(sectionId).classList.add('active');
    
    // Guardar la secci√≥n actual en sessionStorage
    sessionStorage.setItem('adminActiveSection', sectionId);
    
    // Agregar al historial del navegador
    if (window.history && window.history.pushState) {
        window.history.pushState({page: 'admin', section: sectionId}, sectionId, 'admin.html');
    }
    
    // Activar el item del men√∫ correspondiente
    const navItems = document.querySelectorAll('.nav-item');
    navItems.forEach(item => {
        if (item.onclick && item.onclick.toString().includes(`'${sectionId}'`)) {
            item.classList.add('active');
        }
    });
    
    if (window.innerWidth <= 768) {
        document.getElementById('sidebar').classList.remove('open');
    }
    
    loadContent(sectionId);
}

window.deleteMaterial = async function(id) {
    if (!confirm('¬øEst√°s seguro de eliminar este material? Se eliminar√° de todos los dispositivos.')) return;
    try {
        await db.collection('materiales').doc(id).delete();
        await loadMateriales();
        updateStats();
        showAlert('Material eliminado exitosamente');
    } catch (error) {
        console.error('Error al eliminar material:', error);
        alert('Error al eliminar el material');
    }
};

window.savePDF = async function(e) {
    e.preventDefault();
    
    const titulo = document.getElementById('pdf-titulo').value;
    const descripcion = document.getElementById('pdf-descripcion').value;
    const programa = document.getElementById('pdf-programa').value;
    const fileInput = document.getElementById('pdf-file');
    const file = fileInput.files[0];
    
    if (!file) {
        alert('Por favor selecciona un archivo PDF');
        return;
    }
    
    if (file.type !== 'application/pdf') {
        alert('Solo se permiten archivos PDF');
        return;
    }
    
    // L√≠mite de 10MB
    if (file.size > 10 * 1024 * 1024) {
        alert('El archivo es demasiado grande. M√°ximo 10MB');
        return;
    }
    
    const reader = new FileReader();
    reader.onload = async function(event) {
        try {
            const pdfData = event.target.result;
            
            const material = {
                titulo: titulo,
                descripcion: descripcion,
                programa: programa,
                fecha: new Date().toLocaleDateString(),
                tipo: 'pdf',
                pdfData: pdfData,
                nombreArchivo: file.name,
                tamano: file.size,
                fechaCreacion: new Date().toISOString()
            };
            
            // Guardar en Firestore
            await db.collection('materiales').add(material);
            
            document.getElementById('form-pdf').reset();
            await loadMateriales();
            updateStats();
            showAlert('PDF subido exitosamente y sincronizado en todos los dispositivos');
        } catch (error) {
            console.error('Error al guardar PDF:', error);
            alert('Error al subir el PDF. Intenta nuevamente.');
        }
    };
    reader.readAsDataURL(file);
};

// Manejar el bot√≥n atr√°s del navegador
window.addEventListener('popstate', function(event) {
    if (event.state && event.state.section) {
        showSection(event.state.section, null);
    } else {
        // Si no hay estado, ir a inicio
        showSection('inicio', null);
    }
});

// Establecer el estado inicial
history.replaceState({ section: 'inicio' }, '', '#inicio');

window.toggleMobileMenu = function() {
    document.getElementById('sidebar').classList.toggle('open');
}

window.logout = function() {
    if (confirm('¬øEst√°s seguro de que deseas cerrar sesi√≥n?')) {
        sessionStorage.removeItem('currentUser');
        sessionStorage.removeItem('adminActiveSection');
        window.location.replace('index.html');
    }
}

window.saveVideo = function(e) {
    e.preventDefault();
    const formData = new FormData(e.target);
    const video = {
        id: Date.now(),
        titulo: formData.get('titulo'),
        descripcion: formData.get('descripcion'),
        url: formData.get('url'),
        programa: formData.get('programa'),
        fecha: new Date().toLocaleDateString()
    };
    const videos = JSON.parse(localStorage.getItem('videos') || '[]');
    videos.push(video);
    localStorage.setItem('videos', JSON.stringify(videos));
    e.target.reset();
    loadVideos();
    updateStats();
    showAlert('Video guardado exitosamente');
}

window.saveClase = function(e) {
    e.preventDefault();
    const formData = new FormData(e.target);
    const clase = {
        id: Date.now(),
        titulo: formData.get('titulo'),
        contenido: formData.get('contenido'),
        programa: formData.get('programa'),
        fecha: new Date().toLocaleDateString()
    };
    const clases = JSON.parse(localStorage.getItem('clases') || '[]');
    clases.push(clase);
    localStorage.setItem('clases', JSON.stringify(clases));
    e.target.reset();
    loadClases();
    updateStats();
    showAlert('Clase guardada exitosamente');
}

window.saveActividad = function(e) {
    e.preventDefault();
    const formData = new FormData(e.target);
    const actividad = {
        id: Date.now(),
        titulo: formData.get('titulo'),
        instrucciones: formData.get('instrucciones'),
        fecha: formData.get('fecha'),
        programa: formData.get('programa'),
        fechaCreacion: new Date().toLocaleDateString()
    };
    const actividades = JSON.parse(localStorage.getItem('actividades') || '[]');
    actividades.push(actividad);
    localStorage.setItem('actividades', JSON.stringify(actividades));
    e.target.reset();
    loadActividades();
    updateStats();
    showAlert('Actividad creada exitosamente');
}

window.saveCuestionario = function(e) {
    e.preventDefault();
    const formData = new FormData(e.target);
    
    // Recopilar preguntas del formulario
    const preguntas = [];
    const preguntasElements = document.querySelectorAll('.pregunta-item');
    
    preguntasElements.forEach((item, index) => {
        const tipo = item.querySelector('[name^="tipoPregunta"]').value;
        const textoPregunta = item.querySelector('[name^="pregunta"]').value;
        
        if (!textoPregunta.trim()) return; // Saltar preguntas vac√≠as
        
        const pregunta = {
            id: Date.now() + index,
            texto: textoPregunta,
            tipo: tipo
        };
        
        if (tipo === 'multiple') {
            pregunta.opciones = [
                item.querySelector('[name^="opcion1"]').value,
                item.querySelector('[name^="opcion2"]').value,
                item.querySelector('[name^="opcion3"]').value,
                item.querySelector('[name^="opcion4"]').value
            ];
            pregunta.respuestaCorrecta = parseInt(item.querySelector('[name^="correcta"]').value);
        }
        
        preguntas.push(pregunta);
    });
    
    if (preguntas.length === 0) {
        alert('‚ö†Ô∏è Debes agregar al menos una pregunta al cuestionario');
        return;
    }
    
    const cuestionario = {
        id: Date.now(),
        titulo: formData.get('titulo'),
        descripcion: formData.get('descripcion'),
        programa: formData.get('programa'),
        fechaLimite: formData.get('fechaLimite'),
        tiempoDisponible: parseInt(formData.get('tiempoDisponible')),
        intentos: parseInt(formData.get('intentos')),
        preguntas: preguntas,
        fechaCreacion: new Date().toISOString()
    };
    
    const cuestionarios = JSON.parse(localStorage.getItem('cuestionarios') || '[]');
    cuestionarios.push(cuestionario);
    localStorage.setItem('cuestionarios', JSON.stringify(cuestionarios));
    
    e.target.reset();
    document.getElementById('preguntasContainer').innerHTML = '';
    loadCuestionarios();
    updateStats();
    showAlert('Cuestionario guardado exitosamente con ' + preguntas.length + ' preguntas');
}

let contadorPreguntas = 0;

window.agregarPregunta = function() {
    contadorPreguntas++;
    const container = document.getElementById('preguntasContainer');
    
    const preguntaHTML = `
        <div class="pregunta-item" id="pregunta${contadorPreguntas}" style="background: #f8fafc; padding: 20px; border-radius: 8px; margin-bottom: 15px; border-left: 4px solid #3b82f6;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                <h5 style="margin: 0; color: #1e3a8a;"><i class="fas fa-question"></i> Pregunta ${contadorPreguntas}</h5>
                <button type="button" onclick="eliminarPregunta(${contadorPreguntas})" class="btn" style="background: #ef4444; padding: 5px 10px; font-size: 12px;">
                    <i class="fas fa-trash"></i> Eliminar
                </button>
            </div>
            
            <label style="display: block; margin-bottom: 5px; font-weight: 600; color: #0a1628;">Tipo de pregunta</label>
            <select name="tipoPregunta${contadorPreguntas}" onchange="toggleTipoPregunta(${contadorPreguntas})" style="margin-bottom: 15px;" required>
                <option value="multiple">Opci√≥n m√∫ltiple</option>
                <option value="abierta">Respuesta abierta</option>
            </select>
            
            <label style="display: block; margin-bottom: 5px; font-weight: 600; color: #0a1628;">Pregunta</label>
            <textarea name="pregunta${contadorPreguntas}" placeholder="Escribe tu pregunta aqu√≠" rows="2" required style="margin-bottom: 15px;"></textarea>
            
            <div id="opcionesMultiple${contadorPreguntas}">
                <label style="display: block; margin-bottom: 10px; font-weight: 600; color: #0a1628;">Opciones de respuesta</label>
                <div style="display: grid; gap: 10px;">
                    <input type="text" name="opcion1_${contadorPreguntas}" placeholder="Opci√≥n 1" required>
                    <input type="text" name="opcion2_${contadorPreguntas}" placeholder="Opci√≥n 2" required>
                    <input type="text" name="opcion3_${contadorPreguntas}" placeholder="Opci√≥n 3" required>
                    <input type="text" name="opcion4_${contadorPreguntas}" placeholder="Opci√≥n 4" required>
                </div>
                
                <label style="display: block; margin: 15px 0 5px; font-weight: 600; color: #0a1628;">Respuesta correcta</label>
                <select name="correcta${contadorPreguntas}" required>
                    <option value="0">Opci√≥n 1</option>
                    <option value="1">Opci√≥n 2</option>
                    <option value="2">Opci√≥n 3</option>
                    <option value="3">Opci√≥n 4</option>
                </select>
            </div>
            
            <div id="respuestaAbierta${contadorPreguntas}" style="display: none;">
                <p style="color: #64748b; font-size: 14px;"><i class="fas fa-info-circle"></i> Los estudiantes podr√°n escribir su respuesta libremente</p>
            </div>
        </div>
    `;
    
    container.insertAdjacentHTML('beforeend', preguntaHTML);
}

window.eliminarPregunta = function(id) {
    document.getElementById('pregunta' + id).remove();
}

window.toggleTipoPregunta = function(id) {
    const tipo = document.querySelector(`[name="tipoPregunta${id}"]`).value;
    const opcionesDiv = document.getElementById(`opcionesMultiple${id}`);
    const abiertoDiv = document.getElementById(`respuestaAbierta${id}`);
    
    if (tipo === 'multiple') {
        opcionesDiv.style.display = 'block';
        abiertoDiv.style.display = 'none';
        // Hacer campos requeridos
        opcionesDiv.querySelectorAll('input, select').forEach(input => input.required = true);
    } else {
        opcionesDiv.style.display = 'none';
        abiertoDiv.style.display = 'block';
        // Quitar requerimiento
        opcionesDiv.querySelectorAll('input, select').forEach(input => input.required = false);
    }
}

window.saveMaterial = function(e) {
    e.preventDefault();
    const formData = new FormData(e.target);
    const material = {
        id: Date.now(),
        titulo: formData.get('titulo'),
        descripcion: formData.get('descripcion'),
        url: formData.get('url'),
        programa: formData.get('programa'),
        fecha: new Date().toLocaleDateString(),
        tipo: 'enlace'
    };
    const materiales = JSON.parse(localStorage.getItem('materiales') || '[]');
    materiales.push(material);
    localStorage.setItem('materiales', JSON.stringify(materiales));
    e.target.reset();
    loadMateriales();
    updateStats();
    showAlert('Material guardado exitosamente');
}

window.deleteItem = function(type, id) {
    if (confirm('¬øEst√°s seguro de eliminar este elemento?')) {
        const items = JSON.parse(localStorage.getItem(type) || '[]');
        const filtered = items.filter(item => item.id != id); // Usar != para comparaci√≥n flexible
        localStorage.setItem(type, JSON.stringify(filtered));
        loadContent(type);
        updateStats();
        showAlert('Elemento eliminado exitosamente');
    }
}

window.loadContent = function(section) {
    switch(section) {
        case 'videos': loadVideos(); break;
        case 'clases': loadClases(); break;
        case 'actividades': loadActividades(); break;
        case 'cuestionarios': loadCuestionarios(); break;
        case 'evaluaciones': loadEvaluaciones(); break;
        case 'materiales': loadMateriales(); break;
        case 'usuarios': loadUsuarios(); break;
        case 'calificaciones': cargarEstudiantesPorPrograma(); break;
        case 'dashboard': updateStats(); break;
    }
}

function loadVideos() {
    const videos = JSON.parse(localStorage.getItem('videos') || '[]');
    const container = document.getElementById('videos-list');
    if (videos.length === 0) {
        container.innerHTML = '<div class="content-item"><div class="content-info"><h5>No hay videos publicados</h5><p>Los videos que subas aparecer√°n aqu√≠</p></div></div>';
        return;
    }
    container.innerHTML = videos.map(video => `
        <div class="content-item">
            <div class="content-info">
                <h5>${video.titulo}</h5>
                <p>${video.programa} ‚Ä¢ ${video.fecha} ‚Ä¢ <a href="${video.url}" target="_blank">Ver video</a></p>
            </div>
            <div class="content-actions">
                <button class="btn-icon btn-delete" onclick="deleteItem('videos', ${video.id})">
                    <i class="fas fa-trash"></i>
                </button>
            </div>
        </div>
    `).join('');
}

function loadClases() {
    const clases = JSON.parse(localStorage.getItem('clases') || '[]');
    const container = document.getElementById('clases-list');
    if (clases.length === 0) {
        container.innerHTML = '<div class="content-item"><div class="content-info"><h5>No hay clases publicadas</h5><p>Las clases que subas aparecer√°n aqu√≠</p></div></div>';
        return;
    }
    container.innerHTML = clases.map(clase => `
        <div class="content-item">
            <div class="content-info">
                <h5>${clase.titulo}</h5>
                <p>${clase.programa} ‚Ä¢ ${clase.fecha}</p>
            </div>
            <div class="content-actions">
                <button class="btn-icon btn-delete" onclick="deleteItem('clases', ${clase.id})">
                    <i class="fas fa-trash"></i>
                </button>
            </div>
        </div>
    `).join('');
}

function loadActividades() {
    const actividades = JSON.parse(localStorage.getItem('actividades') || '[]');
    const container = document.getElementById('actividades-list');
    if (actividades.length === 0) {
        container.innerHTML = '<div class="content-item"><div class="content-info"><h5>No hay actividades creadas</h5><p>Las actividades que crees aparecer√°n aqu√≠</p></div></div>';
        return;
    }
    container.innerHTML = actividades.map(actividad => `
        <div class="content-item">
            <div class="content-info">
                <h5>${actividad.titulo}</h5>
                <p>${actividad.programa} ‚Ä¢ Entrega: ${actividad.fecha || 'Sin fecha'} ‚Ä¢ Creada: ${actividad.fechaCreacion}</p>
            </div>
            <div class="content-actions">
                <button class="btn-icon btn-delete" onclick="deleteItem('actividades', ${actividad.id})">
                    <i class="fas fa-trash"></i>
                </button>
            </div>
        </div>
    `).join('');
}

function loadCuestionarios() {
    const cuestionarios = JSON.parse(localStorage.getItem('cuestionarios') || '[]');
    const container = document.getElementById('cuestionarios-list');
    if (cuestionarios.length === 0) {
        container.innerHTML = '<div class="content-item"><div class="content-info"><h5>No hay cuestionarios publicados</h5><p>Los cuestionarios que crees aparecer√°n aqu√≠</p></div></div>';
        return;
    }
    container.innerHTML = cuestionarios.map(cuestionario => {
        const fechaLimite = cuestionario.fechaLimite ? new Date(cuestionario.fechaLimite).toLocaleString('es-ES') : 'Sin fecha l√≠mite';
        const numPreguntas = cuestionario.preguntas?.length || 0;
        const tiempoDisp = cuestionario.tiempoDisponible ? cuestionario.tiempoDisponible + ' min' : 'Sin l√≠mite';
        
        return `
        <div class="content-item">
            <div class="content-info">
                <h5>${cuestionario.titulo}</h5>
                <p>${cuestionario.programa} ‚Ä¢ ${numPreguntas} pregunta${numPreguntas !== 1 ? 's' : ''} ‚Ä¢ ${tiempoDisp} ‚Ä¢ ${cuestionario.intentos || 1} intento${cuestionario.intentos !== 1 ? 's' : ''}</p>
                <p style="font-size: 13px; color: #64748b; margin-top: 4px;">${cuestionario.descripcion || ''}</p>
                <p style="font-size: 12px; color: #ef4444; margin-top: 4px;"><i class="fas fa-clock"></i> Fecha l√≠mite: ${fechaLimite}</p>
            </div>
            <div class="content-actions">
                <button class="btn-icon" onclick="verCuestionario(${cuestionario.id})" title="Ver cuestionario">
                    <i class="fas fa-eye"></i>
                </button>
                <button class="btn-icon btn-delete" onclick="deleteCuestionario(${cuestionario.id})" title="Eliminar">
                    <i class="fas fa-trash"></i>
                </button>
            </div>
        </div>
        `;
    }).join('');
}

window.verCuestionario = function(id) {
    const cuestionarios = JSON.parse(localStorage.getItem('cuestionarios') || '[]');
    const cuestionario = cuestionarios.find(c => c.id == id);
    
    if (!cuestionario) return;
    
    let preguntasHTML = cuestionario.preguntas.map((p, index) => {
        if (p.tipo === 'multiple') {
            return `
                <div style="background: #f8fafc; padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                    <h5 style="color: #1e3a8a; margin-bottom: 10px;">${index + 1}. ${p.texto}</h5>
                    <div style="margin-left: 20px;">
                        ${p.opciones.map((op, i) => `
                            <p style="margin: 5px 0; ${i === p.respuestaCorrecta ? 'color: #10b981; font-weight: 600;' : ''}">
                                ${i === p.respuestaCorrecta ? '‚úì' : '‚óã'} ${op}
                            </p>
                        `).join('')}
                    </div>
                </div>
            `;
        } else {
            return `
                <div style="background: #f8fafc; padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                    <h5 style="color: #1e3a8a; margin-bottom: 10px;">${index + 1}. ${p.texto}</h5>
                    <p style="color: #64748b; font-style: italic; margin-left: 20px;"><i class="fas fa-pencil-alt"></i> Respuesta abierta</p>
                </div>
            `;
        }
    }).join('');
    
    alert(`üìã ${cuestionario.titulo}\n\n${cuestionario.descripcion}\n\nPreguntas: ${cuestionario.preguntas.length}\nTiempo: ${cuestionario.tiempoDisponible} min\nIntentos: ${cuestionario.intentos}\n\nVer detalles en consola`);
    console.log('=== CUESTIONARIO ===');
    console.log('T√≠tulo:', cuestionario.titulo);
    console.log('Descripci√≥n:', cuestionario.descripcion);
    console.log('Preguntas:', cuestionario.preguntas);
}

window.deleteCuestionario = function(id) {
    if (!confirm('¬øEliminar este cuestionario?')) return;
    let cuestionarios = JSON.parse(localStorage.getItem('cuestionarios') || '[]');
    cuestionarios = cuestionarios.filter(c => c.id != id);
    localStorage.setItem('cuestionarios', JSON.stringify(cuestionarios));
    loadCuestionarios();
    updateStats();
    showAlert('Cuestionario eliminado');
}
}

window.verCuestionario = function(id) {
    const cuestionarios = JSON.parse(localStorage.getItem('cuestionarios') || '[]');
    const cuestionario = cuestionarios.find(c => c.id === id);
    if (cuestionario) {
        sessionStorage.setItem('cuestionarioPreview', JSON.stringify(cuestionario));
        window.open('preview-cuestionario.html', '_blank');
    }
}

function editarCuestionario(id) {
    const cuestionarios = JSON.parse(localStorage.getItem('cuestionarios') || '[]');
    const cuestionario = cuestionarios.find(c => c.id === id);
    if (cuestionario) {
        sessionStorage.setItem('cuestionarioEditar', JSON.stringify(cuestionario));
        window.location.href = 'crear-cuestionario.html?editar=' + id;
    }
}

window.deleteCuestionario = function(id) {
    if (!confirm('¬øEst√°s seguro de eliminar este cuestionario?')) return;
    let cuestionarios = JSON.parse(localStorage.getItem('cuestionarios') || '[]');
    cuestionarios = cuestionarios.filter(c => c.id !== id);
    localStorage.setItem('cuestionarios', JSON.stringify(cuestionarios));
    loadCuestionarios();
    updateStats();
    showAlert('Cuestionario eliminado exitosamente');
}

function loadEvaluaciones() {
    const evaluaciones = JSON.parse(localStorage.getItem('evaluaciones') || '[]');
    const container = document.getElementById('evaluaciones-list');
    if (evaluaciones.length === 0) {
        container.innerHTML = '<div class="content-item"><div class="content-info"><h5>No hay evaluaciones publicadas</h5><p>Las evaluaciones que crees aparecer√°n aqu√≠</p></div></div>';
        return;
    }
    container.innerHTML = evaluaciones.map(evaluacion => `
        <div class="content-item">
            <div class="content-info">
                <h5>${evaluacion.titulo}</h5>
                <p>${evaluacion.programa} ‚Ä¢ ${evaluacion.numPreguntas} preguntas de ${evaluacion.cuestionarioNombre} ‚Ä¢ ${evaluacion.maxIntentos} intentos</p>
                <p style="font-size: 13px; color: #64748b; margin-top: 4px;">Desde: ${new Date(evaluacion.fechaInicio).toLocaleString()} hasta ${new Date(evaluacion.fechaFin).toLocaleString()}</p>
            </div>
            <div class="content-actions">
                <button class="btn-icon" onclick="verEvaluacion('${evaluacion.id}')" title="Ver evaluaci√≥n">
                    <i class="fas fa-eye"></i>
                </button>
                <button class="btn-icon" onclick="editarEvaluacion('${evaluacion.id}')" title="Editar">
                    <i class="fas fa-edit"></i>
                </button>
                <button class="btn-icon btn-delete" onclick="deleteEvaluacion('${evaluacion.id}')" title="Eliminar">
                    <i class="fas fa-trash"></i>
                </button>
            </div>
        </div>
    `).join('');
}

function verEvaluacion(id) {
    showSection('evaluaciones', event);
}

function editarEvaluacion(id) {
    const evaluaciones = JSON.parse(localStorage.getItem('evaluaciones') || '[]');
    const evaluacion = evaluaciones.find(e => e.id === id);
    if (evaluacion) {
        sessionStorage.setItem('evaluacionEditar', JSON.stringify(evaluacion));
        window.location.href = 'crear-evaluacion.html?editar=' + id;
    }
}

function deleteEvaluacion(id) {
    if (!confirm('¬øEst√°s seguro de eliminar esta evaluaci√≥n?')) return;
    let evaluaciones = JSON.parse(localStorage.getItem('evaluaciones') || '[]');
    evaluaciones = evaluaciones.filter(e => e.id !== id);
    localStorage.setItem('evaluaciones', JSON.stringify(evaluaciones));
    loadEvaluaciones();
    updateStats();
    showAlert('Evaluaci√≥n eliminada exitosamente');
}

async function loadMateriales() {
    try {
        const materialesSnapshot = await db.collection('materiales').orderBy('fechaCreacion', 'desc').get();
        const materiales = [];
        materialesSnapshot.forEach((doc) => {
            materiales.push({ id: doc.id, ...doc.data() });
        });
        
        console.log('üì¶ Admin - Total materiales en Firestore:', materiales.length);
        console.log('üì¶ Materiales:', materiales);
        
        const container = document.getElementById('materiales-list');
        if (materiales.length === 0) {
            container.innerHTML = '<div class="content-item"><div class="content-info"><h5>No hay materiales publicados</h5><p>Los materiales que subas aparecer√°n aqu√≠</p></div></div>';
            return;
        }
        
        container.innerHTML = materiales.map(material => {
            if (material.tipo === 'pdf') {
                const tamanoMB = (material.tamano / (1024 * 1024)).toFixed(2);
                return `
                    <div class="content-item">
                        <div class="content-info">
                            <h5><i class="fas fa-file-pdf" style="color: #dc2626;"></i> ${material.titulo}</h5>
                            <p>${material.descripcion}</p>
                            <p style="font-size: 13px; color: #64748b;">${material.programa} ‚Ä¢ ${material.fecha} ‚Ä¢ ${tamanoMB} MB ‚Ä¢ <a href="ver-documento.html?id=${material.id}" target="_blank">Ver Documento</a></p>
                        </div>
                        <div class="content-actions">
                            <button class="btn-icon" onclick="window.open('ver-documento.html?id=${material.id}', '_blank')" title="Ver PDF">
                                <i class="fas fa-eye"></i>
                            </button>
                            <button class="btn-icon btn-delete" onclick="deleteMaterial('${material.id}')">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                `;
            } else {
                return `
                    <div class="content-item">
                        <div class="content-info">
                            <h5><i class="fas fa-link"></i> ${material.titulo}</h5>
                            <p>${material.descripcion || ''}</p>
                            <p>${material.programa} ‚Ä¢ ${material.fecha} ‚Ä¢ <a href="${material.url}" target="_blank">Ver Material</a></p>
                        </div>
                        <div class="content-actions">
                            <button class="btn-icon btn-delete" onclick="deleteMaterial('${material.id}')">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                `;
            }
        }).join('');
        console.log('‚úÖ Admin - Materiales renderizados desde Firestore');
    } catch (error) {
        console.error('Error al cargar materiales:', error);
        document.getElementById('materiales-list').innerHTML = '<div class="content-item"><div class="content-info"><h5>Error al cargar materiales</h5><p>Intenta recargar la p√°gina</p></div></div>';
    }
}

window.deleteMaterial = async function(id) {
    if (!confirm('¬øEst√°s seguro de eliminar este material? Se eliminar√° de todos los dispositivos.')) return;
    try {
        await db.collection('materiales').doc(id).delete();
        await loadMateriales();
        updateStats();
        showAlert('Material eliminado exitosamente');
    } catch (error) {
        console.error('Error al eliminar material:', error);
        alert('Error al eliminar el material');
    }
}

async function updateStats() {
    document.getElementById('stat-videos').textContent = JSON.parse(localStorage.getItem('videos') || '[]').length;
    document.getElementById('stat-clases').textContent = JSON.parse(localStorage.getItem('clases') || '[]').length;
    document.getElementById('stat-actividades').textContent = JSON.parse(localStorage.getItem('actividades') || '[]').length;
    
    // Contar materiales desde Firestore
    try {
        const materialesSnapshot = await db.collection('materiales').get();
        document.getElementById('stat-materiales').textContent = materialesSnapshot.size;
    } catch (error) {
        console.error('Error al contar materiales:', error);
        document.getElementById('stat-materiales').textContent = '0';
    }
    
    // Actualizar contador de cuestionarios
    const statCuestionarios = document.getElementById('stat-cuestionarios');
    if (statCuestionarios) {
        statCuestionarios.textContent = JSON.parse(localStorage.getItem('cuestionarios') || '[]').length;
    }
}

function showAlert(message) {
    const alertDiv = document.createElement('div');
    alertDiv.className = 'alert alert-success';
    alertDiv.innerHTML = `<i class="fas fa-check-circle"></i><div>${message}</div>`;
    alertDiv.style.position = 'fixed';
    alertDiv.style.top = '80px';
    alertDiv.style.right = '20px';
    alertDiv.style.zIndex = '1000';
    alertDiv.style.minWidth = '300px';
    document.body.appendChild(alertDiv);
    setTimeout(() => alertDiv.remove(), 3000);
}

function loadUsuarios() {
    loadUsuariosPendientes();
    loadUsuariosAprobados();
}

async function loadUsuariosPendientes() {
    const container = document.getElementById('usuarios-pendientes');
    try {
        const response = await fetch('https://firestore.googleapis.com/v1/projects/charlotte-babda/databases/(default)/documents/pendingStudents');
        const data = await response.json();
        if (!data.documents || data.documents.length === 0) {
            container.innerHTML = '<div class="content-item"><div class="content-info"><h5>No hay solicitudes pendientes</h5><p>Las nuevas solicitudes aparecer√°n aqu√≠</p></div></div>';
            return;
        }
        const usuarios = data.documents.map(doc => {
            const fields = doc.fields;
            const id = doc.name.split('/').pop();
            return {
                id,
                name: fields.name?.stringValue || '',
                email: fields.email?.stringValue || '',
                cedula: fields.cedula?.stringValue || '',
                telefono: fields.telefono?.stringValue || '',
                programa: fields.programa?.stringValue || '',
                sede: fields.sede?.stringValue || '',
                password: fields.password?.stringValue || 'charlotte123'
            };
        });
        container.innerHTML = usuarios.map(user => `
            <div class="content-item">
                <div class="content-info">
                    <h5>${user.name}</h5>
                    <p>${user.email} ‚Ä¢ ${user.programa} ‚Ä¢ ${user.sede}</p>
                    <p style="font-size:12px;color:#94a3b8;">C√©dula: ${user.cedula} ‚Ä¢ Tel: ${user.telefono}</p>
                </div>
                <div class="content-actions">
                    <button class="btn btn-primary" style="font-size:12px;padding:8px 16px;" onclick="aprobarUsuario('${user.id}','${user.email}','${user.name}','${user.cedula}','${user.telefono}','${user.programa}','${user.sede}','${user.password}')">
                        <i class="fas fa-check"></i> Aprobar
                    </button>
                    <button class="btn-icon btn-delete" onclick="rechazarUsuario('${user.id}')">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            </div>
        `).join('');
    } catch (error) {
        console.error('Error:', error);
        container.innerHTML = '<div class="content-item"><div class="content-info"><h5>Error al cargar solicitudes</h5></div></div>';
    }
}

async function loadUsuariosAprobados() {
    const container = document.getElementById('usuarios-aprobados');
    const filterPrograma = document.getElementById('filterPrograma')?.value || '';
    const filterLugar = document.getElementById('filterLugar')?.value || '';
    
    try {
        const response = await fetch('https://firestore.googleapis.com/v1/projects/charlotte-babda/databases/(default)/documents/approvedStudents');
        const data = await response.json();
        if (!data.documents || data.documents.length === 0) {
            container.innerHTML = '<div class="content-item"><div class="content-info"><h5>No hay usuarios aprobados</h5></div></div>';
            return;
        }
        
        let usuarios = data.documents.map(doc => {
            const fields = doc.fields;
            const docId = doc.name.split('/').pop();
            return {
                id: docId,
                name: fields.name?.stringValue || '',
                email: fields.email?.stringValue || '',
                password: fields.password?.stringValue || 'charlotte123',
                programa: fields.programa?.stringValue || '',
                sede: fields.sede?.stringValue || '',
                cedula: fields.cedula?.stringValue || '',
                telefono: fields.telefono?.stringValue || ''
            };
        });
        
        // Poblar filtro de lugares
        const lugares = [...new Set(usuarios.map(u => u.sede))].filter(Boolean);
        const filterLugarSelect = document.getElementById('filterLugar');
        if (filterLugarSelect) {
            const currentValue = filterLugarSelect.value;
            filterLugarSelect.innerHTML = '<option value="">Todos los lugares</option>' +
                lugares.map(lugar => `<option value="${lugar}" ${lugar === currentValue ? 'selected' : ''}>${lugar}</option>`).join('');
        }
        
        // Aplicar filtros
        if (filterPrograma) {
            usuarios = usuarios.filter(u => u.programa === filterPrograma);
        }
        if (filterLugar) {
            usuarios = usuarios.filter(u => u.sede === filterLugar);
        }
        
        container.innerHTML = usuarios.map(user => `
            <div class="content-item">
                <div class="content-info">
                    <h5>${user.name}</h5>
                    <p style="margin: 4px 0;">
                        <i class="fas fa-envelope"></i> ${user.email}<br>
                        <i class="fas fa-book"></i> ${user.programa} ‚Ä¢ <i class="fas fa-map-marker-alt"></i> ${user.sede}
                    </p>
                    <div style="margin-top: 8px; padding: 8px; background: #f8fafc; border-radius: 6px; display: inline-block;">
                        <i class="fas fa-key"></i> 
                        <strong>Contrase√±a:</strong> 
                        <span id="pass-${user.id}" style="font-family: monospace; background: #e2e8f0; padding: 4px 8px; border-radius: 4px; margin: 0 8px;">
                            ${user.password}
                        </span>
                        <button onclick="copiarContrasena('${user.password}', '${user.name}')" 
                                class="btn-icon" 
                                title="Copiar contrase√±a"
                                style="background: #8B4513; color: white; padding: 4px 8px; border-radius: 4px;">
                            <i class="fas fa-copy"></i>
                        </button>
                        <button onclick="restablecerContrasena('${user.id}', '${user.email}', '${user.name}', '${user.cedula}', '${user.telefono}', '${user.programa}', '${user.sede}')" 
                                class="btn-icon" 
                                title="Restablecer contrase√±a"
                                style="background: #3b82f6; color: white; padding: 4px 8px; border-radius: 4px;">
                            <i class="fas fa-redo"></i>
                        </button>
                    </div>
                </div>
            </div>
        `).join('');
    } catch (error) {
        console.error('Error:', error);
    }
}

window.aprobarUsuario = async function(id, email, name, cedula, telefono, programa, sede, password) {
    if (!confirm(`¬øAprobar a ${name}?\n\nNOTA: El estudiante deber√° cambiar su contrase√±a en el primer inicio de sesi√≥n.`)) return;
    try {
        // Marcar que necesita cambiar contrase√±a en el primer inicio
        const approvedData = {
            fields: {
                email: { stringValue: email },
                name: { stringValue: name },
                cedula: { stringValue: cedula },
                telefono: { stringValue: telefono },
                programa: { stringValue: programa },
                sede: { stringValue: sede },
                password: { stringValue: password },
                approved: { booleanValue: true },
                needsPasswordReset: { booleanValue: true }
            }
        };
        await fetch(`https://firestore.googleapis.com/v1/projects/charlotte-babda/databases/(default)/documents/approvedStudents/${id}`, {
            method: 'PATCH',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(approvedData)
        });
        await fetch(`https://firestore.googleapis.com/v1/projects/charlotte-babda/databases/(default)/documents/pendingStudents/${id}`, {
            method: 'DELETE'
        });
        showAlert(`Usuario ${name} aprobado exitosamente.\n\nEl estudiante deber√° crear una nueva contrase√±a en su primer inicio de sesi√≥n.`);
        loadUsuarios();
    } catch (error) {
        console.error('Error:', error);
        alert('Error al aprobar usuario');
    }
}

window.rechazarUsuario = async function(id) {
    if (!confirm('¬øRechazar esta solicitud?')) return;
    try {
        await fetch(`https://firestore.googleapis.com/v1/projects/charlotte-babda/databases/(default)/documents/pendingStudents/${id}`, {
            method: 'DELETE'
        });
        showAlert('Solicitud rechazada');
        loadUsuarios();
    } catch (error) {
        console.error('Error:', error);
        alert('Error al rechazar solicitud');
    }
}

window.copiarContrasena = function(password, nombre) {
    navigator.clipboard.writeText(password).then(() => {
        showAlert(`Contrase√±a de ${nombre} copiada al portapapeles`);
    }).catch(err => {
        // Fallback para navegadores que no soportan clipboard API
        const textarea = document.createElement('textarea');
        textarea.value = password;
        document.body.appendChild(textarea);
        textarea.select();
        document.execCommand('copy');
        document.body.removeChild(textarea);
        showAlert(`Contrase√±a de ${nombre} copiada al portapapeles`);
    });
}

window.restablecerContrasena = async function(id, email, name, cedula, telefono, programa, sede) {
    const nuevaContrasena = prompt(`Restablecer contrase√±a para ${name}\n\nIngresa la nueva contrase√±a (dejar vac√≠o para usar "charlotte123"):`, 'charlotte123');
    
    if (nuevaContrasena === null) return; // Usuario cancel√≥
    
    const password = nuevaContrasena.trim() || 'charlotte123';
    
    if (!confirm(`¬øCambiar la contrase√±a de ${name} a "${password}"?`)) return;
    
    try {
        const approvedData = {
            fields: {
                email: { stringValue: email },
                name: { stringValue: name },
                cedula: { stringValue: cedula },
                telefono: { stringValue: telefono },
                programa: { stringValue: programa },
                sede: { stringValue: sede },
                password: { stringValue: password },
                approved: { booleanValue: true }
            }
        };
        
        await fetch(`https://firestore.googleapis.com/v1/projects/charlotte-babda/databases/(default)/documents/approvedStudents/${id}`, {
            method: 'PATCH',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(approvedData)
        });
        
        showAlert(`Contrase√±a restablecida exitosamente para ${name}`);
        loadUsuariosAprobados();
    } catch (error) {
        console.error('Error:', error);
        alert('Error al restablecer contrase√±a');
    }
}

// ===== GESTI√ìN DE CALIFICACIONES =====

async function cargarEstudiantesPorPrograma() {
    const programa = document.getElementById('calificaciones-programa').value;
    const selectEstudiante = document.getElementById('calificaciones-estudiante');
    
    try {
        const response = await fetch('https://firestore.googleapis.com/v1/projects/charlotte-babda/databases/(default)/documents/approvedStudents');
        const data = await response.json();
        
        if (!data.documents) {
            selectEstudiante.innerHTML = '<option value="">No hay estudiantes</option>';
            return;
        }
        
        let estudiantes = data.documents.map(doc => {
            const fields = doc.fields;
            return {
                name: fields.name?.stringValue || '',
                email: fields.email?.stringValue || '',
                programa: fields.programa?.stringValue || ''
            };
        });
        
        if (programa) {
            estudiantes = estudiantes.filter(e => e.programa === programa);
        }
        
        selectEstudiante.innerHTML = '<option value="">Selecciona un estudiante</option>' +
            estudiantes.map(e => `<option value="${e.email}">${e.name} (${e.programa})</option>`).join('');
            
        loadCalificaciones();
    } catch (error) {
        console.error('Error:', error);
    }
}

function loadCalificaciones() {
    const emailEstudiante = document.getElementById('calificaciones-estudiante').value;
    const container = document.getElementById('calificaciones-content');
    
    if (!emailEstudiante) {
        container.innerHTML = '<div style="text-align: center; padding: 60px; color: #64748b;"><i class="fas fa-user-graduate" style="font-size: 48px; margin-bottom: 20px; display: block;"></i><h3>Selecciona un estudiante</h3><p>Elige un estudiante para ver y editar sus calificaciones</p></div>';
        return;
    }
    
    const calificaciones = JSON.parse(localStorage.getItem('calificaciones') || '{}');
    const calificacionesEstudiante = calificaciones[emailEstudiante] || {};
    
    // Obtener actividades, cuestionarios y evaluaciones
    const actividades = JSON.parse(localStorage.getItem('actividades') || '[]');
    const cuestionarios = JSON.parse(localStorage.getItem('cuestionarios') || '[]');
    const evaluaciones = JSON.parse(localStorage.getItem('evaluaciones') || '[]');
    
    let html = '<div style="display: grid; gap: 30px;">';
    
    // ACTIVIDADES
    if (actividades.length > 0) {
        html += `
            <div class="upload-card">
                <h3><i class="fas fa-tasks"></i> Actividades</h3>
                <div style="overflow-x: auto;">
                    <table style="width: 100%; border-collapse: collapse;">
                        <thead>
                            <tr style="background: #f8fafc; border-bottom: 2px solid #e2e8f0;">
                                <th style="padding: 12px; text-align: left;">Actividad</th>
                                <th style="padding: 12px; text-align: left;">Programa</th>
                                <th style="padding: 12px; text-align: center; width: 150px;">Calificaci√≥n</th>
                                <th style="padding: 12px; text-align: center; width: 100px;">Acciones</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${actividades.map(act => {
                                const calificacion = calificacionesEstudiante[`actividad_${act.id}`] || { nota: '', observaciones: '' };
                                return `
                                    <tr style="border-bottom: 1px solid #f1f5f9;">
                                        <td style="padding: 12px;">${act.titulo}</td>
                                        <td style="padding: 12px;">${act.programa}</td>
                                        <td style="padding: 12px; text-align: center;">
                                            <input type="number" 
                                                   id="nota_actividad_${act.id}" 
                                                   value="${calificacion.nota}" 
                                                   min="0" max="100" step="0.1"
                                                   placeholder="0-100"
                                                   style="width: 100px; padding: 8px; border: 2px solid #e2e8f0; border-radius: 6px; text-align: center;">
                                        </td>
                                        <td style="padding: 12px; text-align: center;">
                                            <button onclick="guardarCalificacion('${emailEstudiante}', 'actividad', ${act.id})" 
                                                    class="btn-icon" title="Guardar">
                                                <i class="fas fa-save"></i>
                                            </button>
                                        </td>
                                    </tr>
                                `;
                            }).join('')}
                        </tbody>
                    </table>
                </div>
            </div>
        `;
    }
    
    // CUESTIONARIOS
    if (cuestionarios.length > 0) {
        html += `
            <div class="upload-card">
                <h3><i class="fas fa-file-alt"></i> Cuestionarios</h3>
                <p style="color: #64748b; margin-bottom: 15px;">
                    <i class="fas fa-info-circle"></i> Las calificaciones se registran autom√°ticamente al completar
                </p>
                <div style="overflow-x: auto;">
                    <table style="width: 100%; border-collapse: collapse;">
                        <thead>
                            <tr style="background: #f8fafc; border-bottom: 2px solid #e2e8f0;">
                                <th style="padding: 12px; text-align: left;">Cuestionario</th>
                                <th style="padding: 12px; text-align: left;">Programa</th>
                                <th style="padding: 12px; text-align: center; width: 150px;">Calificaci√≥n</th>
                                <th style="padding: 12px; text-align: center; width: 100px;">Acciones</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${cuestionarios.map(cuest => {
                                const calificacion = calificacionesEstudiante[`cuestionario_${cuest.id}`] || { nota: '', auto: true };
                                return `
                                    <tr style="border-bottom: 1px solid #f1f5f9;">
                                        <td style="padding: 12px;">${cuest.titulo}</td>
                                        <td style="padding: 12px;">${cuest.programa}</td>
                                        <td style="padding: 12px; text-align: center;">
                                            ${calificacion.nota ? `
                                                <input type="number" 
                                                       id="nota_cuestionario_${cuest.id}" 
                                                       value="${calificacion.nota}" 
                                                       min="0" max="100" step="0.1"
                                                       style="width: 100px; padding: 8px; border: 2px solid #e2e8f0; border-radius: 6px; text-align: center;">
                                            ` : '<span style="color: #94a3b8;">No realizado</span>'}
                                        </td>
                                        <td style="padding: 12px; text-align: center;">
                                            ${calificacion.nota ? `
                                                <button onclick="guardarCalificacion('${emailEstudiante}', 'cuestionario', ${cuest.id})" 
                                                        class="btn-icon" title="Editar">
                                                    <i class="fas fa-edit"></i>
                                                </button>
                                            ` : ''}
                                        </td>
                                    </tr>
                                `;
                            }).join('')}
                        </tbody>
                    </table>
                </div>
            </div>
        `;
    }
    
    // EVALUACIONES
    if (evaluaciones.length > 0) {
        html += `
            <div class="upload-card">
                <h3><i class="fas fa-clipboard-check"></i> Evaluaciones</h3>
                <p style="color: #64748b; margin-bottom: 15px;">
                    <i class="fas fa-info-circle"></i> Las calificaciones se registran autom√°ticamente al completar
                </p>
                <div style="overflow-x: auto;">
                    <table style="width: 100%; border-collapse: collapse;">
                        <thead>
                            <tr style="background: #f8fafc; border-bottom: 2px solid #e2e8f0;">
                                <th style="padding: 12px; text-align: left;">Evaluaci√≥n</th>
                                <th style="padding: 12px; text-align: left;">Programa</th>
                                <th style="padding: 12px; text-align: center; width: 150px;">Calificaci√≥n</th>
                                <th style="padding: 12px; text-align: center; width: 100px;">Acciones</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${evaluaciones.map(eval => {
                                const calificacion = calificacionesEstudiante[`evaluacion_${eval.id}`] || { nota: '', auto: true };
                                return `
                                    <tr style="border-bottom: 1px solid #f1f5f9;">
                                        <td style="padding: 12px;">${eval.titulo}</td>
                                        <td style="padding: 12px;">${eval.programa}</td>
                                        <td style="padding: 12px; text-align: center;">
                                            ${calificacion.nota ? `
                                                <input type="number" 
                                                       id="nota_evaluacion_${eval.id}" 
                                                       value="${calificacion.nota}" 
                                                       min="0" max="100" step="0.1"
                                                       style="width: 100px; padding: 8px; border: 2px solid #e2e8f0; border-radius: 6px; text-align: center;">
                                            ` : '<span style="color: #94a3b8;">No realizado</span>'}
                                        </td>
                                        <td style="padding: 12px; text-align: center;">
                                            ${calificacion.nota ? `
                                                <button onclick="guardarCalificacion('${emailEstudiante}', 'evaluacion', ${eval.id})" 
                                                        class="btn-icon" title="Editar">
                                                    <i class="fas fa-edit"></i>
                                                </button>
                                            ` : ''}
                                        </td>
                                    </tr>
                                `;
                            }).join('')}
                        </tbody>
                    </table>
                </div>
            </div>
        `;
    }
    
    html += '</div>';
    container.innerHTML = html;
}

window.guardarCalificacion = function(emailEstudiante, tipo, id) {
    const inputId = `nota_${tipo}_${id}`;
    const nota = document.getElementById(inputId).value;
    
    if (nota === '' || nota < 0 || nota > 100) {
        alert('Ingresa una calificaci√≥n v√°lida entre 0 y 100');
        return;
    }
    
    const calificaciones = JSON.parse(localStorage.getItem('calificaciones') || '{}');
    
    if (!calificaciones[emailEstudiante]) {
        calificaciones[emailEstudiante] = {};
    }
    
    calificaciones[emailEstudiante][`${tipo}_${id}`] = {
        nota: parseFloat(nota),
        fecha: new Date().toLocaleString(),
        tipo: tipo,
        id: id
    };
    
    localStorage.setItem('calificaciones', JSON.stringify(calificaciones));
    showAlert('Calificaci√≥n guardada exitosamente');
}

window.resetCalificaciones = function() {
    document.getElementById('calificaciones-estudiante').value = '';
    document.getElementById('calificaciones-programa').value = '';
    cargarEstudiantesPorPrograma();
}

// Cargar recetas autom√°ticamente
function cargarRecetasIniciales() {
    let materiales = JSON.parse(localStorage.getItem('materiales') || '[]');
    
    // Primero, SIEMPRE eliminar todas las recetas antiguas
    materiales = materiales.filter(m => !m.url || (!m.url.includes('receta') && !m.url.includes('recetario')));
    
    // Agregar solo el √≠ndice de recetas - SOLO PARA PANADER√çA
    const recetas = [
        {
            id: 'recetario-index',
            titulo: '√çndice de Recetas',
            descripcion: 'Navegaci√≥n r√°pida por todas las categor√≠as de recetas',
            url: 'recetario-index.html',
            programa: 'Panader√≠a',
            fecha: new Date().toLocaleDateString()
        }
    ];
    
    materiales = materiales.concat(recetas);
    localStorage.setItem('materiales', JSON.stringify(materiales));
    console.log('‚úÖ Recetas cargadas autom√°ticamente:', recetas.length);
    
    // Recargar materiales si estamos en esa secci√≥n
    if (document.getElementById('materiales') && document.getElementById('materiales').classList.contains('active')) {
        loadMateriales();
    }
}

cargarRecetasIniciales();
updateStats();
    </script>
</body>
</html>

